!function(a,s){function r(e){for(var t={},i=0;i<this.update.length;i++){var n=this.update[i];n.value===e&&_.extend(t,n.fields)}var o="refresh"===this.__initialTransport;for(var a in t){var s=wp.customize(a);if(s){var r=s.transport;s.transport="postMessage",kirkiSetSettingValue(a,t[a]),"refresh"===(s.transport=r)&&(o=!0)}}o&&wp.customize.previewer.refresh()}s(function(){s("img[data-src]").each(function(){var e=this;setTimeout(function(){e.setAttribute("src",e.getAttribute("data-src"))},5)})}),a.Materialis||(a.Materialis={Utils:{getGradientString:function(e,t){var i=t+"deg, "+e[0].color+" 0%, "+e[1].color+" 100%";return i="linear-gradient("+i+")"},getValue:function(e){var t=void 0;if(e instanceof wp.customize.Control&&(t=e.setting.get()),e instanceof wp.customize.Setting&&(t=e.get()),_.isString(e)&&(t=wp.customize(e).get()),_.isString(t)){try{t=decodeURI(t)}catch(e){}try{t=JSON.parse(t)}catch(e){}}return t}},hooks:{addAction:function(){},addFilter:function(){},doAction:function(){},applyFilters:function(){}},wpApi:a.wp.customize,closePopUps:function(){a.tb_remove(),a.jQuery("#TB_overlay").css({"z-index":"-1"})},options:function(e){return a.materialis_customize_settings[e]},popUp:function(e,t,i){var n="#TB_inline?inlineId="+t,o=[];return s.each(i||{},function(e,t){o.push(e+"="+t)}),n=o.length?n+"&":n+"",n+=o.join("&"),a.tb_show(e,n),a.jQuery("#TB_window").css({"z-index":"5000001",transform:"opacity .4s",opacity:0}),a.jQuery("#TB_overlay").css({"z-index":"5000000"}),setTimeout(function(){a.jQuery("#TB_window").css({"margin-top":(a.jQuery("#TB_window").outerHeight()+50)/2*-1,opacity:1}),a.jQuery("#TB_window").find("#cp-item-ok").focus()},0),i&&i.class&&a.jQuery("#TB_window").addClass(i.class),a.jQuery("#TB_window")},addModule:function(e){var t=this;jQuery(document).ready(function(){e(t)})},getCustomizerRootEl:function(){return a.jQuery(a.document.body).find("form#customize-controls")},openRightSidebar:function(e,t){t=t||{},this.hideRightSidebar();var i=this.getCustomizerRootEl(),n=this,o=i.find("#"+e+"-popup");o.length?(o.addClass("active"),t.floating&&!_(t.y).isUndefined()&&o.css({top:t.y})):(o=s('<li id="'+e+'-popup" class="customizer-right-section active"> <span data-close-right-sidebar="true" title="'+materialis_customize_settings.l10n.closePanelLabel+'" class="close-panel"></span> </li>'),t.floating&&o.addClass("floating"),$toAppend=i.find("li#accordion-section-"+e+" > ul"),0===$toAppend.length&&($toAppend=i.find("#sub-accordion-section-"+e)),0===$toAppend.length&&($toAppend=s('<div class="control-wrapper" />'),$toAppend.append(i.find("#customize-control-"+e).children())),i.append(o),o.append($toAppend),t.floating&&!_(t.y).isUndefined()&&o.css({top:t.y}),o.find("span.close-panel").click(n.hideRightSidebar)),t.focus&&o.find(t.focus)[0].scrollIntoViewIfNeeded(),o.css("left",jQuery("#customize-header-actions")[0].offsetWidth+1),n.hooks.doAction("right_sidebar_opened",e,t,o),o.on("focus",function(e){return e.preventDefault(),e.stopPropagation(),!1}),i.find('span[data-close-right-sidebar="true"]').click(function(e){e.preventDefault(),e.stopPropagation(),n.hideRightSidebar()}),i.find("li.accordion-section").unbind("click.right-section").bind("click.right-section",function(e){(s(e.target).is("li")||s(e.target).is(".accordion-section-title"))&&0===s(e.target).closest(".customizer-right-section").length&&n.hideRightSidebar()})},hideRightSidebar:function(){var e=a.jQuery(a.document.body).find("#customize-controls").find(".customizer-right-section.active");e.length&&e.removeClass("active")},linkMod:function(e,t){var i=wp.customize(e);if(i){var n=i.findControls().length?jQuery.extend(!0,{},i.findControls()):{};n.__initialTransport=i.transport,n.update=t;var o=_.bind(r,n);i.transport="postMessage",i.bind(o)}},createMod:function(e,t){return wp.customize(e)?wp.customize(e):(e="CP_AUTO_SETTING["+e+"]",wp.customize(e)||wp.customize.create(e,e,{},{type:"theme_mod",transport:t||"postMessage",previewer:wp.customize.previewer}),wp.customize(e))},_canUpdatedLinkedOptions:!0,canUpdatedLinkedOptions:function(){return this._canUpdatedLinkedOptions},disableLinkedOptionsUpdater:function(){this._canUpdatedLinkedOptions=!1},enableLinkedOptionsUpdater:function(){this._canUpdatedLinkedOptions=!0}}),a.Materialis.openMediaBrowser=function(i,n,o){var e,t,a,s,r,c;switch(e=n instanceof jQuery?function(e){if(e){var t=e[0].url;"multiple"!==o&&("icon"==i&&(t=e[0].mdi),n.val(t).trigger("change"))}}:n,i){case"image":t=materialis_customize_settings.l10n.changeImageLabel,a=e,s=o,r=window.parent,(c=r.wp.media.frames.file_frame=r.wp.media({title:t,button:{text:materialis_customize_settings.l10n.chooseImagesLabel},multiple:!s})).on("select",function(){attachment=c.state().get("selection").toJSON(),a(attachment)}),c.off("close.cp").on("close.cp",function(){a(!1)}),c.open(),c.content.mode("browse"),r.jQuery(r.wp.media.frame.views.selector).parent().css({"z-index":"16000000"})}},a.Materialis.openMediaCustomFrame=function(e,t,i,n,o){var a=window.parent,s=new(e(a.wp.media.view.MediaFrame.Select))({title:i,button:{text:i},multiple:!n});s.on("select",function(){attachment=s.state().get("selection").toJSON(),s.content.mode("browse"),o(attachment)}),s.on("close",function(){s.content.mode("browse"),o(!1)}),s.open(),s.content.mode(t),a.jQuery(s.views.selector).parent().css({"z-index":"16000000"})},window.wp&&window.wp.customize&&(wp.customize.controlConstructor["radio-html"]=wp.customize.Control.extend({ready:function(){"use strict";var e=this;this.container.on("click","input",function(){e.setting.set(jQuery(this).val())})}}));var e=!1;wp.customize.bind("pane-contents-reflowed",function(){if(!e){e=!0,jQuery.each(wp.customize.settings.controls,function(e,t){if(t.update&&Materialis.canUpdatedLinkedOptions()){var i=wp.customize(t.settings.default);t.__initialTransport=i.transport;var n=_.bind(r,t);i.transport="postMessage",i.bind(n)}});var i=Materialis.createMod("header_overlappable_section");i.bind(function(t){if(CP_Customizer&&t){if(!CP_Customizer.wpApi("header_overlap").get())return;var e=CP_Customizer.options("data:sections").filter(function(e){return e.id===t}).pop();e&&0===CP_Customizer.preview.jQuery('[data-id^="'+t+'"]').length&&CP_Customizer.one(CP_Customizer.events.PREVIEW_LOADED,function(){CP_Customizer.preview.insertSectionFromData(e)})}i.set("")})}})}(window,jQuery),function(e){e(document).on("mouseup",".selectize-input",function(){e(this).parent().height()+e(this).parent().offset().top>window.innerHeight&&e(".wp-full-overlay-sidebar-content").scrollTop(e(this).parent().height()+e(this).parent().offset().top)}),e(document).on("change",".customize-control-kirki-select select",function(){e(this).focusout()})}(jQuery),function(e,a,s){var t=!1;wp.customize.bind("pane-contents-reflowed",function(){t||(t=!0,s.previewer.bind("focus-control-for-setting",function(i){var n=[];if(s.control.each(function(e){var t=_.pluck(e.settings,"id");-1!==_.indexOf(t,i)&&n.push(e)}),n.length){var e=n[0],t=e.container.closest(".customizer-right-section");if(t.length){var o='[data-sidebar-container="'+t.attr("id").replace("-popup","")+'"]';a(o).length&&(a(o)[0].scrollIntoView(),a(o).click()),e.focus()}}}))})}(window,jQuery,wp.customize),function(o){var i,n=window.wp.media?window.wp:parent.wp,s=!1,a=(i=_.memoize(function(e){return new RegExp("^"+e.replace(/./g,function(e){return/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/.test(e)?"\\"+e+"?":e+"?"})+"$")}),function(e,t){return i(e).test(t)}),r={},e=Backbone.Model.extend({defaults:{buttons:{check:!0},can:{save:!1,remove:!1},id:null,title:null,date:null,modified:null,mime:"web-gradient/class",dateFormatted:null,height:null,width:null,orientation:null,filesizeInBytes:null,filesizeHumanReadable:null,size:{url:null},type:"web-gradient",icon:null,parsed:!1}}),c=Backbone.Collection.extend({model:e,initialize:function(e){this.url=parent.ajaxurl+"?action=materialis_webgradients_list"},parse:function(e){return e}}),t=_.template('<div class="attachment-preview js--select-attachment type-image subtype-jpeg landscape"><div class="thumbnail"><div class="webgradient <%= webgradient %>" aria-hidden="true"></i><div class="label"><%= title %></div></div><button type="button" class="button-link check" tabindex="0"><span class="media-modal-icon"></span><span class="screen-reader-text">'+materialis_customize_settings.l10n.deselect+"</span></button></div>"),l=n.media.view.Attachment.extend({tagName:"li",className:"attachment webgradients-image",template:t,controller:this.controller,initialize:function(){this.render()},attributes:function(){return{"data-search":this.model.get("gradient").trim(),"aria-label":this.model.get("title"),title:this.model.get("title"),tabIndex:0}},events:{"click .js--select-attachment":"toggleSelectionHandler"},render:function(){var e=this.model.get("gradient"),t=this.model.get("title");this.$el.html(this.template({webgradient:e,title:t}))},toggleSelectionHandler:function(e){37!==e.keyCode&&38!==e.keyCode&&39!==e.keyCode&&40!==e.keyCode?"keydown"===e.type&&13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),e.shiftKey?"between":(e.ctrlKey||e.metaKey)&&"toggle",this.toggleSelection({method:"add"}),o(".media-selection.one .attachment-preview.type-mdi-icon .thumbnail").html('<div class="webgradient '+this.model.get("gredient")+'"></div>'),this.controller.trigger("selection:toggle")):this.controller.trigger("attachment:keydown:arrow",e)}}),d=n.media.View.extend({tagName:"ul",className:"attachments cp-mdi-images",attributes:{tabIndex:0},initialize:function(){_.defaults(this.options,{refreshSensitivity:n.media.isTouchDevice?300:200,refreshThreshold:3,AttachmentView:n.media.view.Attachment,sortable:!1,resize:!1,idealColumnWidth:150}),this._viewsByCid={},this.$window=o(window),this.options.scrollElement=this.options.scrollElement||this.el,o(this.options.scrollElement).on("scroll",this.scroll);var i=this;i.collection.each(function(e){var t=new l({controller:i.controller,selection:i.options.selection,model:e});i.views.add(t)})},scroll:function(){}}),u=n.media.View.extend({tagName:"input",className:"search",id:"media-search-input cp-mdi-search",attributes:{type:"search",placeholder:n.media.view.l10n.search},events:{input:"search",keyup:"search",change:"search",search:"search"},render:function(){return this},search:_.debounce(function(e){var n=e.target.value;this.options.browserView.view.$el.find("li").each(function(e,t){var i=o(t);a(i.data("search"),n)?i.show():i.hide()})},50)}),p=n.media.View.extend({tagName:"div",className:"cp-mdi-media attachments-browser",initialize:function(){var o=this;_.defaults(this.options,{filters:!1,search:!0,date:!1,display:!1,sidebar:!1,toolbar:!0,AttachmentView:n.media.view.Attachment.Library});var e=new c,a=!!this.options.options&&this.options.options.filter;function t(e){a&&(e=new c(e.filter(a)));var t=o.controller.state(),i=t.get("selection");t.set("multiple",!1),i.multiple=!1;var n=new d({controller:o.controller,selection:i,collection:e});o.views.add(n)}s?t(s):e.fetch({success:function(e){t(s=e)}}),this.createToolbar()},settings:function(e){this._settings&&this._settings.remove(),this._settings=e,this.views.add(e)},createToolbar:function(){this.toolbar=new n.media.view.Toolbar({controller:this.controller}),this.views.add(this.toolbar),this.toolbar.set("search",new u({controller:this.controller,browserView:this.views}))}});function h(e){var t=e,i={browseRouter:function(e){var t={cp_web_gradients:{text:materialis_customize_settings.l10n.chooseGradientLabel,priority:50}};controller=e.controller,e.set(t)},bindHandlers:function(){t.prototype.bindHandlers.apply(this,arguments),this.on("content:create:cp_web_gradients",this.cpBrowseMaterialIcons,this)},createStates:function(){t.prototype.createStates.apply(this,arguments)},cpBrowseMaterialIcons:function(e){this.state();this.$el.removeClass("hide-toolbar"),e.view=new p({controller:this,options:r})}};return t.extend(i)}n.media.cp=n.media.cp||{},n.media.cp.extendFrameWithWebGradients||(n.media.cp.extendFrameWithWebGradients=function(e){return r=e,h})}(jQuery),wp.customize.controlConstructor["web-gradients"]=wp.customize.Control.extend({ready:function(){"use strict";var t=this;this.container.on("click","button, .webgradient-icon-preview .webgradient",function(){Materialis.openMediaCustomFrame(wp.media.cp.extendFrameWithWebGradients(),"cp_web_gradients",materialis_customize_settings.l10n.selectGradient,!0,function(e){e&&e[0]&&(t.setting.set(e[0].gradient),t.container.find(".webgradient-icon-preview > div.webgradient").attr("class","webgradient "+e[0].gradient),t.container.find(".webgradient-icon-preview > div.webgradient + .label").text(e[0].gradient.replace(/_/gi," ")))})})}}),window,jQuery,wp.customize.controlConstructor["gradient-control"]=wp.customize.Control.extend({ready:function(){"use strict";var i=this;this.getValue(),this.container.on("click","button, .webgradient-icon-preview .webgradient",function(){Materialis.openMediaCustomFrame(wp.media.cp.extendFrameWithWebGradients({filter:function(e){return!1!==e.get("parsed")}}),"cp_web_gradients",materialis_customize_settings.l10n.selectGradient,!0,function(e){if(e&&e[0]){var t=e[0].parsed;i.params.choices&&i.params.choices.opacity&&(t.colors=t.colors.map(function(e){var t=tinycolor(e.color);return t.setAlpha(i.params.choices.opacity),e.color=t.toRgbString(),e})),i.setValue(t)}})})},getValue:function(){"use strict";return _.isString(this.setting.get())?JSON.parse(this.setting.get()):this.setting.get()},setValue:function(e,t){this.setting.set(JSON.stringify(e)),this.update(e)},update:function(e){this.container.find(".webgradient-icon-preview > div.webgradient").attr("style","background:"+Materialis.Utils.getGradientString(e.colors,e.angle))}}),wp.customize.controlConstructor["sidebar-button-group"]=wp.customize.Control.extend({ready:function(){var n=this,o=this.params.choices,a=this.params.popup,s=this.params.in_row_with||[];n.container.find("#group_customize-button-"+a).click(function(){window.CP_Customizer?CP_Customizer.openRightSidebar(a):Materialis.openRightSidebar(a)}),n.container.find("#"+a+"-popup > ul").on("focus",function(e){return!1}),wp.customize.bind("pane-contents-reflowed",function(){var t=n.container.find("#"+a+"-popup > ul"),i=[];_.each(o,function(e){var t=wp.customize.control(e);t&&i.push(t)}),_.each(i,function(e){t.append(e.container)}),s&&s.length&&_.each(s,function(e){n.container.css({width:"calc(35% - 6px)",clear:"right",float:"right"});var t=wp.customize.control(e);t&&t.container.css({width:"auto","max-width":"calc(65% - 6px)"})});var e=n.params.choices.map(function(e){return!!wp.customize.control(e)&&wp.customize.control(e).active()}).reduce(function(e,t){return e||t});n.params.always_active||n.active()&&(e?n.activate():n.deactivate())})}});
